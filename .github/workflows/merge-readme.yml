name: Merge READMEs

# ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
on:
  push:
    paths:
      - '**/README.md'  # í•˜ìœ„ ë””ë ‰í† ë¦¬ì˜ README.md íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ íŠ¸ë¦¬ê±°
  pull_request:
    paths:
      - '**/README.md'  # PR ìƒì„± ì‹œ íŠ¸ë¦¬ê±°

jobs:
  build:
    runs-on: ubuntu-latest  # ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  OS í™˜ê²½
    
    permissions:  # GITHUB_TOKENì˜ ê¶Œí•œ ëª…ì‹œ
      contents: write  # ì»¤ë°‹ ë° í‘¸ì‹œë¥¼ í—ˆìš©

    steps:
      # 1. ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Python ì„¤ì •
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9  # Python ë²„ì „ ì§€ì •

      # 3. Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: Merge README files
        run: |
          import os
          import markdown
          from collections import defaultdict

          def merge_tables(directory, output_file):
              # ë³‘í•©í•  í…Œì´ë¸”ì„ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬
              combined_tables = defaultdict(list)
              
              # ëª¨ë“  README.md íŒŒì¼ íƒìƒ‰
              for subdir, dirs, files in os.walk(directory):
                  for file in files:
                      if file == "README.md":
                          file_path = os.path.join(subdir, file)
                          with open(file_path, 'r', encoding='utf-8') as f:
                              content = f.read()
                              
                              # ê° í‘œì˜ ì œëª©ì„ ê¸°ì¤€ìœ¼ë¡œ í…Œì´ë¸” êµ¬ë¶„ (ì˜ˆ: 'ğŸ“– í•™ìŠµí•˜ê¸°', 'ğŸ¥‡ ì‹¤ì „ í›ˆë ¨')
                              for line in content.splitlines():
                                  if line.startswith("## "):  # ì œëª©ì´ ìˆì„ ë•Œ
                                      section = line.strip().split(" ")[1]  # ì œëª© ì´ë¦„ (ì˜ˆ: 'í•™ìŠµí•˜ê¸°', 'ì‹¤ì „ í›ˆë ¨')
                                  if line.startswith("|"):  # í…Œì´ë¸” ë°ì´í„°
                                      combined_tables[section].append(line)
              
              # ë³‘í•©ëœ ë‚´ìš©ì„ ì¶œë ¥ íŒŒì¼ì— ì‘ì„±
              with open(output_file, 'w', encoding='utf-8') as outfile:
                  # Markdown ë¬¸ë²•ìœ¼ë¡œ íŒŒì¼ ì‘ì„±
                  
                  # Write 'í•™ìŠµí•˜ê¸°' table
                  outfile.write("## ğŸ“– í•™ìŠµí•˜ê¸°\n\n")
                  for table in combined_tables["í•™ìŠµí•˜ê¸°"]:
                      outfile.write(table + "\n\n")

                  # Write 'ì‹¤ì „ í›ˆë ¨' table
                  outfile.write("## ğŸ¥‡ ì‹¤ì „ í›ˆë ¨\n\n")
                  for table in combined_tables["ì‹¤ì „ í›ˆë ¨"]:
                      outfile.write(table + "\n\n")

          # í˜„ì¬ ë””ë ‰í† ë¦¬ì—ì„œ README.md íŒŒì¼ ë³‘í•©
          merge_tables(".", "README.md")


      # 4. ë³€ê²½ëœ íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit changes
        run: |
          git config user.name "ddings73"
          git config user.email "ddings7303@gmail.com"
          git add README.md
          git commit -m "README ë³‘í•©"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.MY_SECRET_TOKEN }}

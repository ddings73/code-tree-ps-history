name: Merge READMEs

# 이벤트 트리거
on:
  push:
    paths:
      - '**/README.md'  # 하위 디렉토리의 README.md 파일이 변경되었을 때 트리거
  pull_request:
    paths:
      - '**/README.md'  # PR 생성 시 트리거

jobs:
  build:
    runs-on: ubuntu-latest  # 워크플로우를 실행할 OS 환경

    steps:
      # 1. 코드를 체크아웃
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Python 설정
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9  # Python 버전 지정

      # 3. 스크립트 실행
      - name: Merge READMEs
        run: |
          python <<EOF
          import os

          def merge_readmes(base_dir, output_file):
              with open(output_file, 'w', encoding='utf-8') as outfile:
                  outfile.write("# Combined README\n\n")
                  for root, dirs, files in os.walk(base_dir):
                      for file in files:
                          if file.lower() == "readme.md" and root != base_dir:
                              filepath = os.path.join(root, file)
                              with open(filepath, 'r', encoding='utf-8') as infile:
                                  relative_dir = os.path.relpath(root, base_dir)
                                  outfile.write(f"## {relative_dir}\n\n")
                                  outfile.write(infile.read() + "\n\n")

          merge_readmes(".", "./README.md")
          EOF

      # 4. 변경된 파일 커밋 및 푸시
      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add README.md
          git commit -m "README 병합"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.MY_SECRET_TOKEN }}

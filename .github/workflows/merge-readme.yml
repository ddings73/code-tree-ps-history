name: Merge READMEs

# ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
on:
  push:
    paths:
      - '**/README.md'  # í•˜ìœ„ ë””ë ‰í† ë¦¬ì˜ README.md íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ íŠ¸ë¦¬ê±°
  pull_request:
    paths:
      - '**/README.md'  # PR ìƒì„± ì‹œ íŠ¸ë¦¬ê±°

jobs:
  merge-readmes:
    runs-on: ubuntu-latest
    
    permissions:  # GITHUB_TOKENì˜ ê¶Œí•œ ëª…ì‹œ
      contents: write  # ì»¤ë°‹ ë° í‘¸ì‹œë¥¼ í—ˆìš©

    steps:
    - name: Check out the repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'

    - name: Merge all README.md files into a single one using Python
      run: |
        python <<EOF
        import os

        # ì¶œë ¥ íŒŒì¼ ê²½ë¡œ
        output_file = "./README.md"

        # ê¸°ì¡´ì— README.md íŒŒì¼ì´ ìˆìœ¼ë©´ ì‚­ì œ
        if os.path.exists(output_file):
            os.remove(output_file)

        # ë³‘í•©í•  íŒŒì¼ì„ ìœ„í•œ í—¤ë” ì‘ì„±
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write("# ğŸ“– í•™ìŠµí•˜ê¸°\n\n")
            f.write("# ğŸ¥‡ ì‹¤ì „ í›ˆë ¨\n")
            f.write("|ê¸°ë¡ë¶„ë¥˜|ì´ë¦„|í‹°ì–´|ìœ í˜•|ìƒíƒœ|ìµœê·¼ ì œì¶œ ì½”ë“œ|\n")
            f.write("|---|---|---|---|---|---|\n")

        # í•˜ìœ„ ë””ë ‰í† ë¦¬ë¥¼ ìˆœíšŒí•˜ë©° README.md íŒŒì¼ì„ ì°¾ì•„ ë³‘í•©
        for root, dirs, files in os.walk("."):
            for file in files:
              if file.lower() == "readme.md" and root != ".":
                readme_path = os.path.join(root, file)
                
                start_extraction = False
                with open(readme_path, 'r', encoding='utf-8') as f:
                  if "|ê¸°ë¡ë¶„ë¥˜|" in line and "|ì´ë¦„|" in line and "|í‹°ì–´|" in line and "|ìœ í˜•|" in line and "|ìƒíƒœ|" in line and "|ìµœê·¼ ì œì¶œ ì½”ë“œ|" in line:
                    start_extracting = True  # ì´ ì´í›„ì˜ ë¼ì¸ë¶€í„° ë°ì´í„° ì¶”ì¶œ ì‹œì‘
                  elif start_extraction:
                    if "|" in line and "-" not in line:
                        columns = line.split('|')
                        if len(columns) > 1:
                            title = columns[1].strip()  # ì´ë¦„
                            tier = columns[2].strip()   # í‹°ì–´
                            type_ = columns[3].strip()  # ìœ í˜•
                            status = columns[4].strip() # ìƒíƒœ
                            code_link = columns[5].strip() # ìµœê·¼ ì œì¶œ ì½”ë“œ


                            if title and tier and type_ and status and code_link:
                                with open(output_file, 'a', encoding='utf-8') as f_out:
                                    f_out.write(f"|ê¸°ì¶œë¬¸ì œ|[{title}](https://www.codetree.ai/training-field/frequent-problems/problems/{title})|{tier}|{type_}|{status}|[{code_link}]({code_link})|\n")

        # í•˜ë‹¨ì— ì´ë¯¸ì§€ ë°°ì§€ ì¶”ê°€
        badge_urls = [
            ("b5", "https://img.shields.io/badge/Bronze_5-%235D3E31.svg"),
            ("b4", "https://img.shields.io/badge/Bronze_4-%235D3E31.svg"),
            ("b3", "https://img.shields.io/badge/Bronze_3-%235D3E31.svg"),
            ("b2", "https://img.shields.io/badge/Bronze_2-%235D3E31.svg"),
            ("b1", "https://img.shields.io/badge/Bronze_1-%235D3E31.svg"),
            ("s5", "https://img.shields.io/badge/Silver_5-%23394960.svg"),
            ("s4", "https://img.shields.io/badge/Silver_4-%23394960.svg"),
            ("s3", "https://img.shields.io/badge/Silver_3-%23394960.svg"),
            ("s2", "https://img.shields.io/badge/Silver_2-%23394960.svg"),
            ("s1", "https://img.shields.io/badge/Silver_1-%23394960.svg"),
            ("g5", "https://img.shields.io/badge/Gold_5-%23FFC433.svg"),
            ("g4", "https://img.shields.io/badge/Gold_4-%23FFC433.svg"),
            ("g3", "https://img.shields.io/badge/Gold_3-%23FFC433.svg"),
            ("g2", "https://img.shields.io/badge/Gold_2-%23FFC433.svg"),
            ("g1", "https://img.shields.io/badge/Gold_1-%23FFC433.svg"),
            ("p5", "https://img.shields.io/badge/Platinum_5-%2376DDD8.svg"),
            ("p4", "https://img.shields.io/badge/Platinum_4-%2376DDD8.svg"),
            ("p3", "https://img.shields.io/badge/Platinum_3-%2376DDD8.svg"),
            ("p2", "https://img.shields.io/badge/Platinum_2-%2376DDD8.svg"),
            ("p1", "https://img.shields.io/badge/Platinum_1-%2376DDD8.svg"),
            ("passed", "https://img.shields.io/badge/Passed-%23009D27.svg"),
            ("failed", "https://img.shields.io/badge/Failed-%23D24D57.svg"),
            ("easy", "https://img.shields.io/badge/ì‰¬ì›€-%235cb85c.svg?for-the-badge"),
            ("medium", "https://img.shields.io/badge/ë³´í†µ-%23FFC433.svg?for-the-badge"),
            ("hard", "https://img.shields.io/badge/ì–´ë ¤ì›€-%23D24D57.svg?for-the-badge")
        ]

        with open(output_file, 'a', encoding='utf-8') as f:
            for label, url in badge_urls:
                f.write(f"[{label}]: {url}\n")
                
        EOF
        
    # 4. ë³€ê²½ëœ íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
    - name: Commit changes
      run: |
        git config user.name "ddings73"
        git config user.email "ddings7303@gmail.com"
        git add README.md
        git commit -m "README ë³‘í•©"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.MY_SECRET_TOKEN }}

name: Merge READMEs

# ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
on:
  push:
    paths:
      - '**/README.md'  # í•˜ìœ„ ë””ë ‰í† ë¦¬ì˜ README.md íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ íŠ¸ë¦¬ê±°
  pull_request:
    paths:
      - '**/README.md'  # PR ìƒì„± ì‹œ íŠ¸ë¦¬ê±°

jobs:
  merge-readmes:
    runs-on: ubuntu-latest

    steps:
    - name: Check out the repository
      uses: actions/checkout@v2

    - name: Set up Node.js (Optional if you need JS dependencies)
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Install dependencies (Optional, if needed)
      run: |
        npm install

    - name: Merge all README.md files into a single one
      run: |
        OUTPUT_FILE="README.md"

        if [ -f $OUTPUT_FILE ]; then
          rm $OUTPUT_FILE
        fi

        echo "# ðŸ“– í•™ìŠµí•˜ê¸°" > $OUTPUT_FILE
        echo "" >> $OUTPUT_FILE
        echo "# ðŸ¥‡ ì‹¤ì „ í›ˆë ¨" >> $OUTPUT_FILE
        echo "|ê¸°ë¡ë¶„ë¥˜|ì´ë¦„|í‹°ì–´|ìœ í˜•|ìƒíƒœ|ìµœê·¼ ì œì¶œ ì½”ë“œ|" >> $OUTPUT_FILE
        echo "|---|---|---|---|---|---|" >> $OUTPUT_FILE

        for folder in $(find . -type d -not -path '*/\.*'); do
          README="$folder/README.md"
          
          if [ -f "$README" ]; then
            TITLE=$(grep -oP '(?<=\#\#\s)(.*?)(?=\s\-\-)' "$README")
            TIER=$(grep -oP '(?<=í‹°ì–´:)(.*?)(?=\n)' "$README")
            TYPE=$(grep -oP '(?<=ìœ í˜•:)(.*?)(?=\n)' "$README")
            STATUS=$(grep -oP '(?<=ìƒíƒœ:)(.*?)(?=\n)' "$README")
            CODE_LINK=$(grep -oP '(?<=ì½”ë“œ ë§í¬:)(.*?)(?=\n)' "$README")

            echo "|ê¸°ì¶œë¬¸ì œ|[$TITLE](https://www.codetree.ai/training-field/frequent-problems/problems/$TITLE)|$TIER|$TYPE|$STATUS|[$CODE_LINK]($CODE_LINK)|" >> $OUTPUT_FILE
          fi
        done

        echo "" >> $OUTPUT_FILE
        echo "[b5]: https://img.shields.io/badge/Bronze_5-%235D3E31.svg" >> $OUTPUT_FILE
        echo "[b4]: https://img.shields.io/badge/Bronze_4-%235D3E31.svg" >> $OUTPUT_FILE
        echo "[b3]: https://img.shields.io/badge/Bronze_3-%235D3E31.svg" >> $OUTPUT_FILE
        echo "[b2]: https://img.shields.io/badge/Bronze_2-%235D3E31.svg" >> $OUTPUT_FILE
        echo "[b1]: https://img.shields.io/badge/Bronze_1-%235D3E31.svg" >> $OUTPUT_FILE
        echo "[s5]: https://img.shields.io/badge/Silver_5-%23394960.svg" >> $OUTPUT_FILE
        echo "[s4]: https://img.shields.io/badge/Silver_4-%23394960.svg" >> $OUTPUT_FILE
        echo "[s3]: https://img.shields.io/badge/Silver_3-%23394960.svg" >> $OUTPUT_FILE
        echo "[s2]: https://img.shields.io/badge/Silver_2-%23394960.svg" >> $OUTPUT_FILE
        echo "[s1]: https://img.shields.io/badge/Silver_1-%23394960.svg" >> $OUTPUT_FILE
        echo "[g5]: https://img.shields.io/badge/Gold_5-%23FFC433.svg" >> $OUTPUT_FILE
        echo "[g4]: https://img.shields.io/badge/Gold_4-%23FFC433.svg" >> $OUTPUT_FILE
        echo "[g3]: https://img.shields.io/badge/Gold_3-%23FFC433.svg" >> $OUTPUT_FILE
        echo "[g2]: https://img.shields.io/badge/Gold_2-%23FFC433.svg" >> $OUTPUT_FILE
        echo "[g1]: https://img.shields.io/badge/Gold_1-%23FFC433.svg" >> $OUTPUT_FILE
        echo "[p5]: https://img.shields.io/badge/Platinum_5-%2376DDD8.svg" >> $OUTPUT_FILE
        echo "[p4]: https://img.shields.io/badge/Platinum_4-%2376DDD8.svg" >> $OUTPUT_FILE
        echo "[p3]: https://img.shields.io/badge/Platinum_3-%2376DDD8.svg" >> $OUTPUT_FILE
        echo "[p2]: https://img.shields.io/badge/Platinum_2-%2376DDD8.svg" >> $OUTPUT_FILE
        echo "[p1]: https://img.shields.io/badge/Platinum_1-%2376DDD8.svg" >> $OUTPUT_FILE
        echo "[passed]: https://img.shields.io/badge/Passed-%23009D27.svg" >> $OUTPUT_FILE
        echo "[failed]: https://img.shields.io/badge/Failed-%23D24D57.svg" >> $OUTPUT_FILE
        echo "[easy]: https://img.shields.io/badge/ì‰¬ì›€-%235cb85c.svg?for-the-badge" >> $OUTPUT_FILE
        echo "[medium]: https://img.shields.io/badge/ë³´í†µ-%23FFC433.svg?for-the-badge" >> $OUTPUT_FILE
        echo "[hard]: https://img.shields.io/badge/ì–´ë ¤ì›€-%23D24D57.svg?for-the-badge" >> $OUTPUT_FILE

    - name: Commit changes
      run: |
        git config user.name "ddings73"
        git config user.email "ddings7303@gmail.com"
        git add $OUTPUT_FILE
        git commit -m "Update merged README file"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.MY_SECRET_TOKEN }}
